# Find process using port 5001


<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->

## Auto-Reload in Python Scripts

For scripts (`.py` files), enable auto-reload using uvicorn directly:

**1. Structure your script with app at module level:**

``` python
# my_bot.py
from pylogue.chatapp import create_default_chat_app

async def my_responder(msg: str, context=None) -> str:
    return f"Response: {msg}"

# Create app at module level (not inside if __name__)
app = create_default_chat_app(responder=my_responder)

if __name__ == "__main__":
    app.run(port=5001)
```

**2. Run with uvicorn for auto-reload:**

``` bash
# From the directory containing my_bot.py
uvicorn my_bot:app --reload --port 5001

# Or with full path
uvicorn scripts.examples.basic-functionality.1-echo-bot:echo_app --reload --port 5001
```

Now any changes to the file will automatically restart the server!

# Running Pylogue in Jupyter Notebooks

This notebook shows how to run Pylogue chat applications directly in
Jupyter notebooks using FastHTML‚Äôs Jupyter utilities.

``` python
import asyncio
from fasthtml.common import *
from fasthtml.jupyter import JupyUvi, HTMX
from pylogue.chatapp import create_default_chat_app
```

## Method 1: Using JupyUvi (Recommended)

`JupyUvi` starts a uvicorn server in a background thread, perfect for
Jupyter notebooks.

``` python
# Define a simple responder
import random, time


async def my_responder(message: str, context=None) -> str:
    s = random.random() * 2
    await asyncio.sleep(s)
    return f"ü§ñ Response: {message.upper()}\n‚è±Ô∏è Waited {s:.2f}s"


# Try to stop existing server
try:
    time.sleep(1)
    server.stop()
    # Wait for port to be free
    time.sleep(1)
except Exception as e:
    print(f"‚ö†Ô∏è Stop attempt: {e}")

# Create and start new server
app = create_default_chat_app(responder=my_responder)
port = "5005"
server = JupyUvi(app.get_app(), port=port)
print(f"‚úÖ Server running at http://localhost:{port}")
```

    ‚ö†Ô∏è Stop attempt: name 'server' is not defined

<script>
document.body.addEventListener('htmx:configRequest', (event) => {
    if(event.detail.path.includes('://')) return;
    htmx.config.selfRequestsOnly=false;
    event.detail.path = `${location.protocol}//${location.hostname}:5005${event.detail.path}`;
});
</script>

    ‚úÖ Server running at http://localhost:5005
    üì§ Sending chunk #1: 'ü§ñ Response: TELL ME A HAIKU\n‚è±Ô∏è Waited 0.36s'

The server is now running! You can: 1. Access it at:
http://localhost:5001 2. Display it in an iframe below (uncomment the
next cell to see it)

**To make changes**: Just modify the `my_responder` function above and
re-run the cell. The `restart_server()` helper will safely stop and
restart.

``` python
# Display the app in an iframe within the notebook
# Uncomment the line below to see the app embedded in the notebook
HTMX(port=5005)
```

<iframe src="http://localhost:5005/" style="width: 100%; height: auto; border: none;" onload="{
        let frame = this;
        window.addEventListener('message', function(e) {
            if (e.source !== frame.contentWindow) return; // Only proceed if the message is from this iframe
            if (e.data.height) frame.style.height = (e.data.height+1) + 'px';
        }, false);
    }" allow="accelerometer; autoplay; camera; clipboard-read; clipboard-write; display-capture; encrypted-media; fullscreen; gamepad; geolocation; gyroscope; hid; identity-credentials-get; idle-detection; magnetometer; microphone; midi; payment; picture-in-picture; publickey-credentials-get; screen-wake-lock; serial; usb; web-share; xr-spatial-tracking"></iframe> 

## Stopping Servers

Always stop servers when you‚Äôre done to free up ports:

``` python
# Stop all servers
server.stop()
```

    TypeError: 'str' object cannot be interpreted as an integer
    [31m---------------------------------------------------------------------------[39m
    [31mTypeError[39m                                 Traceback (most recent call last)
    [36mCell[39m[36m [39m[32mIn[4][39m[32m, line 2[39m
    [32m      1[39m [38;5;66;03m# Stop all servers[39;00m
    [32m----> [39m[32m2[39m [43mserver[49m[43m.[49m[43mstop[49m[43m([49m[43m)[49m

    [36mFile [39m[32m~/Code/Personal/pylogue/.venv/lib/python3.13/site-packages/fasthtml/jupyter.py:98[39m, in [36mJupyUvi.stop[39m[34m(self)[39m
    [32m     96[39m [38;5;28;01mdef[39;00m[38;5;250m [39m[34mstop[39m([38;5;28mself[39m):
    [32m     97[39m     [38;5;28mself[39m.server.should_exit = [38;5;28;01mTrue[39;00m
    [32m---> [39m[32m98[39m     [43mwait_port_free[49m[43m([49m[38;5;28;43mself[39;49m[43m.[49m[43mport[49m[43m)[49m

    [36mFile [39m[32m~/Code/Personal/pylogue/.venv/lib/python3.13/site-packages/fasthtml/jupyter.py:53[39m, in [36mwait_port_free[39m[34m(port, host, max_wait)[39m
    [32m     51[39m [33m"[39m[33mWait for `port` to be free on `host`[39m[33m"[39m
    [32m     52[39m start_time = time.time()
    [32m---> [39m[32m53[39m [38;5;28;01mwhile[39;00m [38;5;129;01mnot[39;00m [43mis_port_free[49m[43m([49m[43mport[49m[43m)[49m:
    [32m     54[39m     [38;5;28;01mif[39;00m time.time() - start_time>max_wait: [38;5;28;01mreturn[39;00m [38;5;28mprint[39m([33mf[39m[33m"[39m[33mTimeout[39m[33m"[39m)
    [32m     55[39m     time.sleep([32m0.1[39m)

    [36mFile [39m[32m~/Code/Personal/pylogue/.venv/lib/python3.13/site-packages/fasthtml/jupyter.py:44[39m, in [36mis_port_free[39m[34m(port, host)[39m
    [32m     42[39m [38;5;28;01mtry[39;00m:
    [32m     43[39m     sock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, [32m1[39m)
    [32m---> [39m[32m44[39m     [43msock[49m[43m.[49m[43mbind[49m[43m([49m[43m([49m[43mhost[49m[43m,[49m[43m [49m[43mport[49m[43m)[49m[43m)[49m
    [32m     45[39m     [38;5;28;01mreturn[39;00m [38;5;28;01mTrue[39;00m
    [32m     46[39m [38;5;28;01mexcept[39;00m [38;5;167;01mOSError[39;00m: [38;5;28;01mreturn[39;00m [38;5;28;01mFalse[39;00m

    [31mTypeError[39m: 'str' object cannot be interpreted as an integer

## Tips for Jupyter Development

### 1. Port Management

Each server needs a unique port. Use different ports (5001, 5002, etc.)
for multiple apps.

### 2. Safe Server Restart Pattern

**Problem**: Calling `server.stop()` doesn‚Äôt immediately free the port,
causing ‚Äúaddress already in use‚Äù errors.

**Solution**: Use a helper function with proper wait:

``` python
import time

def restart_server(port=5001):
    global server
    try:
        if 'server' in globals() and server is not None:
            server.stop()
            time.sleep(1)  # Wait for port to free
    except: pass
    
    app = create_default_chat_app(responder=my_responder)
    server = JupyUvi(app.get_app(), port=port)
    return server

# Now you can safely rerun this cell
server = restart_server(port=5001)
```

### 3. Viewing Apps

- Use `HTMX()` to embed the app in an iframe within the notebook
- Or open http://localhost:PORT in your browser

### 4. Debugging

Server logs appear in the notebook output. Set `log_level="info"` for
more details:

``` python
server = JupyUvi(app.get_app(), port=5001, log_level="info")
```

### 5. Common Issues

**‚ÄúAddress already in use‚Äù error:** - The port hasn‚Äôt been freed yet
after `stop()` - Solution: Add `time.sleep(1)` after `server.stop()` -
Or use a different port temporarily

**Cell blocks during execution:** - This happens when the server crashes
but the port is still bound - Solution: Restart the Jupyter kernel
(Kernel ‚Üí Restart) - Or use `lsof -ti:5001 | xargs kill` in terminal to
force-free the port

**Changes not reflected:** - Make sure to stop and restart the server -
The server loads code once at startup - Use the restart helper function
pattern above

### 6. Development Workflow

**Best practice for rapid iteration:**

``` python
# 1. Define responder in a cell
async def my_responder(msg: str, context=None) -> str:
    return f"Version 2: {msg}"

# 2. Restart in same cell or next cell
server = restart_server(port=5001)

# 3. Test in browser, then modify responder and re-run
```

**Alternative: Use different ports during development:**

``` python
# Iteration 1
server1 = JupyUvi(app1.get_app(), port=5001)

# Iteration 2 (new port, no need to stop)
server2 = JupyUvi(app2.get_app(), port=5002)

# Clean up later
server1.stop()
server2.stop()
```

### 7. WebSocket Support

Pylogue‚Äôs streaming works seamlessly in Jupyter notebooks!

## Next Steps

- Check `5-Examples.ipynb` for more responder patterns
- See `scripts/examples/ai/pydantic-ai.py` for LLM integration
- Read the documentation notebooks (0-Card through 4-ChatApp) for deep
  dives
